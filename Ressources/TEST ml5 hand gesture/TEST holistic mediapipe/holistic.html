<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="holistic.css">
  <!-- <script src="holistic.js"></script> -->

</head>

<body>
  <div class="container">
    <video hidden class="input_video"></video>
    <canvas class="output_canvas" width="1280px" height="720px"></canvas>
    <script type="module">
        const videoElement = document.getElementsByClassName('input_video')[0];
        const canvasElement = document.getElementsByClassName('output_canvas')[0];
        const canvasCtx = canvasElement.getContext('2d');

        var img = new Image();
        img.src = "images/beach.jpg";
        
        function onResults(results) {
          canvasCtx.save();
          canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
          canvasCtx.drawImage(results.segmentationMask, 0, 0,
                              canvasElement.width, canvasElement.height);
        
          // Only overwrite existing pixels.
          canvasCtx.globalCompositeOperation = 'source-in';
        //   canvasCtx.fillStyle = '#00FF00';
        //   canvasCtx.fillRect(0, 0, canvasElement.width, canvasElement.height);
        canvasCtx.drawImage(
              results.image, 0, 0, canvasElement.width, canvasElement.height);
        
          // Only overwrite missing pixels.
          canvasCtx.globalCompositeOperation = 'destination-atop';
        //   canvasCtx.filter = "blur(10px)";
          // flux video
          canvasCtx.drawImage(
              img, 0, 0, canvasElement.width, canvasElement.height);
        
          canvasCtx.globalCompositeOperation = 'source-over';
        //   drawConnectors(canvasCtx, results.poseLandmarks, POSE_CONNECTIONS,
        //                  {color: '#00FF00', lineWidth: 4}); //body batons
        //   drawLandmarks(canvasCtx, results.poseLandmarks,
        //                 {color: '#FF0000', lineWidth: 2}); //body points
        //   drawConnectors(canvasCtx, results.faceLandmarks, FACEMESH_TESSELATION,
        //                  {color: '#C0C0C070', lineWidth: 1}); //visage mesh
          drawConnectors(canvasCtx, results.leftHandLandmarks, HAND_CONNECTIONS,
                         {color: '#CC0000', lineWidth: 5}); // batons main gauche
          drawLandmarks(canvasCtx, results.leftHandLandmarks,
                        {color: '#00FF00', lineWidth: 2});// points main gauche
          drawConnectors(canvasCtx, results.rightHandLandmarks, HAND_CONNECTIONS,
                         {color: '#00CC00', lineWidth: 5}); //batons main droite
          drawLandmarks(canvasCtx, results.rightHandLandmarks,
                        {color: '#FF0000', lineWidth: 2}); //points main droite
          canvasCtx.restore();
          if(results.rightHandLandmarks){
            console.log("index main droite : "+results.rightHandLandmarks[8].x);
          }


        }

        
        const holistic = new Holistic({locateFile: (file) => {
          return `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${file}`;
        }});
        holistic.setOptions({
          modelComplexity: 2,
          smoothLandmarks: true,
          enableSegmentation: true,
          smoothSegmentation: true,
          refineFaceLandmarks: true,
          minDetectionConfidence: 0.5,
          minTrackingConfidence: 0.5
        });
        holistic.onResults(onResults);
        
        const camera = new Camera(videoElement, {
          onFrame: async () => {
            await holistic.send({image: videoElement});
          },
          width: 1280,
          height: 720
        });
        camera.start();
        </script>

  </div>
</body>
</html>